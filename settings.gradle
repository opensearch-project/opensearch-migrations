/*
 * This file was generated by the Gradle 'init' task.
 *
 * The settings file is used to specify which projects to include in your build.
 *
 * Detailed information about configuring a multi-project build in Gradle can be found
 * in the user manual at https://docs.gradle.org/8.0.2/userguide/multi_project_builds.html
 */
import java.nio.file.Paths

plugins {
    id("com.gradle.develocity") version("3.18.1")
    id 'org.gradle.toolchains.foojay-resolver-convention' version '0.10.0'
}

void addSubProjects(String path, File dir) {
    if (dir.isDirectory() == false) {
        return;
    }
    if (dir.name == 'buildSrc') {
        return;
    }
    if (new File(dir, 'build.gradle').exists() == false) {
        return;
    }
    if (findProject(dir) != null) {
        return;
    }

    final String projectName = "${path}:${dir.name}"
    include projectName

    project(projectName).projectDir = dir

    for (File subdir : dir.listFiles()) {
        addSubProjects(projectName, subdir)
    }
}

rootProject.name = 'OpensearchMigrations'
include 'awsUtilities'
include 'coreUtilities'
include 'deployment:migration-assistant-solution'
include 'libraries:kafkaCommandLineFormatter'
include 'libraries:kafkaUtils'
include 'transformation'
include 'transformation:standardJavascriptTransforms'
include 'testHelperFixtures'
include 'jenkinsTests'
include 'RFS'
include 'SnapshotReader'
include 'CreateSnapshot'
include 'dashboardsSanitizer'
include 'DataGenerator'
include 'MetadataMigration'
include 'DocumentsFromSnapshotMigration'
include 'migrationConsole'
include 'TrafficCapture:captureKafkaOffloader'
include 'TrafficCapture:captureOffloader'
include 'TrafficCapture:captureProtobufs'
include 'TrafficCapture:dockerSolution'
include 'TrafficCapture:nettyWireLogging'
include 'TrafficCapture:trafficCaptureProxyServer'
include 'TrafficCapture:trafficReplayer'
include 'frontend'
include 'buildImages'
include 'kiro-cli'
include ':console_link'

project(':console_link').projectDir = file('migrationConsole/lib/console_link')


addSubProjects(':transformation', Paths.get(rootProject.projectDir.getPath(), 'transformation', 'transformationPlugins').toFile())

if (System.getenv().containsKey("OS_MIGRATIONS_GRADLE_SCAN_TOS_AGREE_AND_ENABLED")) {
    develocity {
        buildScan {
            publishing.onlyIf { true }
            termsOfUseUrl = "https://gradle.com/help/legal-terms-of-use"
            termsOfUseAgree = "yes"
        }
    }
} else {
    develocity {
        buildScan {
            publishing.onlyIf { false }
        }
    }
}
