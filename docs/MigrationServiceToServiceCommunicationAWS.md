# Migration Service-to-Service Communication in AWS
There are two currently supported ways for Migration services to communicate with each other, [Service Connect](https://docs.aws.amazon.com/AmazonECS/latest/developerguide/service-connect.html) and [Service Discovery](https://docs.aws.amazon.com/AmazonECS/latest/developerguide/service-discovery.html). Both approaches build on top of AWS Cloud Map with our solution creating a unique Namespace for each stage that is deployed. If both approaches are enabled for a Migration service, both Namespace service entries created will be in the same Namespace. To take this a bit further, each AWS Cloud Map Namespace is built on top of a Route53 hosted zone which will contain relevant DNS records.

**Note**: Different Security Groups are created around Migration services to limit access effectively. These will allow Migration services to communicate with each other and limit access to external resources (such as MSK) on a service by service basis.

### ECS Service Connect
This is the preferred means of communication between Migration services. A Migration service can opt in for Service Connect without providing a port for other services to connect to. In this case the Migration service would be seen as only having the client option enabled, and would be able to communicate with other services in the same Namespace that have a port exposed but no service would be able to connect to its ports. Also in this case no Namespace service entry would get created for this Migration service. Alternatively a Migration service can provide a port for other services to connect to, which will expose a port on that service for other Migration services in the Namespace and create a service entry in the Namespace.

**Note**: ECS Services load available services to connect to with Service Connect at startup. This means that if say the Migration Console service wants to communicate with the Capture Proxy service's exposed port, the Migration Console must be deployed **after** the Capture Proxy service.

### ECS Service Discovery
This method of communication was added to support communication between Migration ECS services and Migration ECS tasks that are within the same ECS cluster. Since from ECS terms this is now Task-to-Service communication, it does not appear to be currently available to utilize Service Connect. The scenario mentioned is applicable to our Fetch Migration use case where a user would kick off a Fetch Migration task from the Migration Console service container and this task would need the ability to communicate with other Migration services during its runtime.

This approach will create a service entry in the AWS Cloud Map Namespace which allows DNS queries to configured services, which in turn opens the door for the Task-to-Service communication needed.
