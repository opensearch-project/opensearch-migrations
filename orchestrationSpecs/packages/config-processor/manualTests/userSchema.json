{
  "type": "object",
  "properties": {
    "kafkaClusters": {
      "type": "array",
      "items": {
        "type": "object",
        "properties": {
          "name": {
            "type": "string"
          },
          "config": {
            "type": "object",
            "properties": {}
          },
          "topics": {
            "type": "array",
            "items": {
              "type": "string"
            }
          }
        },
        "required": [
          "name",
          "config",
          "topics"
        ]
      },
      "minItems": 1
    },
    "proxies": {
      "type": "array",
      "items": {
        "type": "object",
        "properties": {
          "name": {
            "type": "string"
          },
          "kafkaConfig": {
            "type": "object",
            "properties": {
              "enableMSKAuth": {
                "type": "boolean",
                "default": false
              },
              "kafkaConnection": {
                "type": "string",
                "pattern": "^(?:[a-z.]+:[0-9]+,?)*$"
              },
              "kafkaTopic": {
                "type": "string",
                "default": "",
                "description": "Empty defaults to the name of the target label"
              },
              "label": {
                "type": "string"
              }
            },
            "required": [
              "kafkaConnection",
              "label"
            ]
          },
          "sourceEndpoint": {
            "type": "string"
          },
          "proxyConfig": {
            "type": "object",
            "properties": {
              "loggingConfigurationOverrideConfigMap": {
                "type": "string",
                "default": ""
              },
              "podReplicas": {
                "type": "number",
                "default": 1
              },
              "resources": {
                "type": "object",
                "properties": {
                  "limits": {
                    "type": "object",
                    "properties": {
                      "cpu": {
                        "type": "string",
                        "pattern": "^[0-9]+m$",
                        "description": "CPU quantity in millicores (e.g., '100m', '500m')"
                      },
                      "memory": {
                        "type": "string",
                        "pattern": "^[0-9]+(([EPTGM])i?|Ki|k)$",
                        "description": "Memory quantity with unit (e.g., '512Mi', '2G')"
                      },
                      "ephemeral-storage": {
                        "type": "string",
                        "pattern": "^[0-9]+(([EPTGM])i?|Ki|k)$",
                        "description": "Storage quantity with unit (e.g., '10Gi', '5G')"
                      }
                    },
                    "required": [
                      "cpu",
                      "memory"
                    ],
                    "description": "Resource upper bound for a container"
                  },
                  "requests": {
                    "type": "object",
                    "properties": {
                      "cpu": {
                        "type": "string",
                        "pattern": "^[0-9]+m$",
                        "description": "CPU quantity in millicores (e.g., '100m', '500m')"
                      },
                      "memory": {
                        "type": "string",
                        "pattern": "^[0-9]+(([EPTGM])i?|Ki|k)$",
                        "description": "Memory quantity with unit (e.g., '512Mi', '2G')"
                      },
                      "ephemeral-storage": {
                        "type": "string",
                        "pattern": "^[0-9]+(([EPTGM])i?|Ki|k)$",
                        "description": "Storage quantity with unit (e.g., '10Gi', '5G')"
                      }
                    },
                    "required": [
                      "cpu",
                      "memory"
                    ],
                    "description": "Resource lower bound for a container"
                  }
                },
                "default": {
                  "limits": {
                    "cpu": "2000m",
                    "memory": "4000Mi"
                  },
                  "requests": {
                    "cpu": "2000m",
                    "memory": "4000Mi"
                  }
                },
                "required": [
                  "limits",
                  "requests"
                ],
                "description": "Resource limits and requests for replayer container."
              },
              "otelCollectorEndpoint": {
                "type": "string",
                "default": "http://otel-collector:4317"
              },
              "setHeaders": {
                "type": "array",
                "items": {
                  "type": "string"
                }
              },
              "destinationConnectionPoolSize": {
                "type": "number",
                "default": 0
              },
              "destinationConnectionPoolTimeout": {
                "type": "string",
                "pattern": "^[-+]?P(?:(\\d+)D)?(?:T(?:(\\d+)H)?(?:(\\d+)M)?(?:(\\d+(?:\\.\\d+)?)S)?)?$",
                "default": "PT30S"
              },
              "kafkaClientId": {
                "type": "string",
                "default": "HttpCaptureProxyProducer"
              },
              "listenPort": {
                "type": "number"
              },
              "maxTrafficBufferSize": {
                "type": "number",
                "default": 1048576
              },
              "noCapture": {
                "type": "boolean",
                "default": false
              },
              "numThreads": {
                "type": "number",
                "default": 1
              },
              "sslConfigSettings": {
                "type": "string",
                "default": ""
              },
              "suppressCaptureForHeaderMatch": {
                "type": "array",
                "items": {
                  "type": "string"
                },
                "default": []
              },
              "suppressCaptureForMethod": {
                "type": "array",
                "items": {
                  "type": "string"
                },
                "default": []
              },
              "suppressCaptureForUriPath": {
                "type": "array",
                "items": {
                  "type": "string"
                },
                "default": []
              },
              "suppressMethodAndPath": {
                "type": "string",
                "default": ""
              }
            },
            "required": [
              "listenPort"
            ]
          }
        },
        "required": [
          "name",
          "kafkaConfig",
          "sourceEndpoint",
          "proxyConfig"
        ]
      },
      "default": []
    },
    "snapshots": {
      "type": "array",
      "items": {
        "type": "object",
        "properties": {
          "createSnapshotConfig": {
            "type": "array",
            "items": {
              "type": "object",
              "properties": {
                "label": {
                  "type": "string"
                },
                "snapshotPrefix": {
                  "type": "string"
                },
                "config": {
                  "type": "object",
                  "properties": {
                    "indexAllowlist": {
                      "type": "array",
                      "items": {
                        "type": "string"
                      },
                      "default": []
                    },
                    "maxSnapshotRateMbPerNode": {
                      "type": "number",
                      "default": 0
                    },
                    "loggingConfigurationOverrideConfigMap": {
                      "type": "string",
                      "default": ""
                    }
                  }
                },
                "repo": {
                  "type": "object",
                  "properties": {
                    "awsRegion": {
                      "type": "string",
                      "description": "The AWS region that the bucket reside in (us-east-2, etc)"
                    },
                    "endpoint": {
                      "type": "string",
                      "pattern": "(?:^(http|localstack)s?:\\/\\/[^/]*\\/?$)?",
                      "default": ""
                    },
                    "s3RepoPathUri": {
                      "type": "string",
                      "pattern": "^s3:\\/\\/[a-z0-9][a-z0-9.-]{1,61}[a-z0-9](\\/[a-zA-Z0-9!\\-_.*'()/]*)?$",
                      "description": "s3://BUCKETNAME/PATH"
                    },
                    "s3RoleArn": {
                      "type": "string",
                      "pattern": "^(arn:aws:iam::\\d{12}:(user|role|group|policy)\\/[a-zA-Z0-9+=,.@_-]+)?$",
                      "default": ""
                    },
                    "useLocalStack": {
                      "type": "boolean",
                      "default": false
                    },
                    "repoName": {
                      "type": "string"
                    }
                  },
                  "required": [
                    "awsRegion",
                    "s3RepoPathUri",
                    "repoName"
                  ]
                },
                "semaphoreConfigMapName": {
                  "type": "string"
                },
                "semaphoreKey": {
                  "type": "string"
                },
                "dependsOnProxySetups": {
                  "type": "array",
                  "items": {
                    "type": "string"
                  },
                  "minItems": 1
                }
              },
              "required": [
                "label",
                "snapshotPrefix",
                "config",
                "repo",
                "semaphoreConfigMapName",
                "semaphoreKey"
              ]
            },
            "minItems": 1
          },
          "sourceConfig": {
            "type": "object",
            "properties": {
              "endpoint": {
                "type": "string",
                "pattern": "^(?:https?:\\/\\/[^:\\/\\s]+(:\\d+)?(\\/)?)?$",
                "default": ""
              },
              "allowInsecure": {
                "type": "boolean",
                "default": false
              },
              "authConfig": {
                "anyOf": [
                  {
                    "type": "object",
                    "properties": {
                      "basic": {
                        "type": "object",
                        "properties": {
                          "secretName": {
                            "type": "string",
                            "pattern": "^[a-z0-9]([-a-z0-9]*[a-z0-9])?(\\.[a-z0-9]([-a-z0-9]*[a-z0-9])?)*$"
                          }
                        },
                        "required": [
                          "secretName"
                        ]
                      }
                    },
                    "required": [
                      "basic"
                    ]
                  },
                  {
                    "type": "object",
                    "properties": {
                      "sigv4": {
                        "type": "object",
                        "properties": {
                          "region": {
                            "type": "string"
                          },
                          "service": {
                            "type": "string",
                            "default": "es"
                          }
                        },
                        "required": [
                          "region"
                        ]
                      }
                    },
                    "required": [
                      "sigv4"
                    ]
                  },
                  {
                    "type": "object",
                    "properties": {
                      "mtls": {
                        "type": "object",
                        "properties": {
                          "caCert": {
                            "type": "string"
                          },
                          "clientSecretName": {
                            "type": "string"
                          }
                        },
                        "required": [
                          "caCert",
                          "clientSecretName"
                        ]
                      }
                    },
                    "required": [
                      "mtls"
                    ]
                  }
                ]
              },
              "version": {
                "type": "string",
                "pattern": "^(?:ES [125678]|OS [123])(?:\\.[0-9]+)+$"
              },
              "label": {
                "type": "string"
              }
            },
            "required": [
              "version",
              "label"
            ]
          }
        },
        "required": [
          "createSnapshotConfig",
          "sourceConfig"
        ]
      },
      "default": []
    },
    "snapshotMigrations": {
      "type": "array",
      "items": {
        "type": "object",
        "properties": {
          "label": {
            "type": "string"
          },
          "snapshotNameResolution": {
            "anyOf": [
              {
                "type": "object",
                "properties": {
                  "externalSnapshotName": {
                    "type": "string"
                  }
                },
                "required": [
                  "externalSnapshotName"
                ]
              },
              {
                "type": "object",
                "properties": {
                  "dataSnapshotResourceName": {
                    "type": "string"
                  }
                },
                "required": [
                  "dataSnapshotResourceName"
                ]
              }
            ]
          },
          "migrations": {
            "type": "array",
            "items": {
              "type": "object",
              "properties": {
                "label": {
                  "type": "string"
                },
                "metadataMigrationConfig": {
                  "type": "object",
                  "properties": {
                    "componentTemplateAllowlist": {
                      "type": "array",
                      "items": {
                        "type": "string"
                      },
                      "default": []
                    },
                    "indexAllowlist": {
                      "type": "array",
                      "items": {
                        "type": "string"
                      },
                      "default": []
                    },
                    "indexTemplateAllowlist": {
                      "type": "array",
                      "items": {
                        "type": "string"
                      },
                      "default": []
                    },
                    "allowLooseVersionMatching": {
                      "type": "boolean",
                      "default": true
                    },
                    "clusterAwarenessAttributes": {
                      "type": "number",
                      "default": 1
                    },
                    "loggingConfigurationOverrideConfigMap": {
                      "type": "string",
                      "default": ""
                    },
                    "multiTypeBehavior": {
                      "anyOf": [
                        {
                          "type": "string",
                          "enum": [
                            "NONE"
                          ]
                        },
                        {
                          "type": "string",
                          "enum": [
                            "UNION"
                          ]
                        },
                        {
                          "type": "string",
                          "enum": [
                            "SPLIT"
                          ]
                        }
                      ],
                      "default": "NONE"
                    },
                    "otelCollectorEndpoint": {
                      "type": "string",
                      "default": "http://otel-collector:4317"
                    },
                    "output": {
                      "anyOf": [
                        {
                          "type": "string",
                          "enum": [
                            "HUMAN_READABLE"
                          ]
                        },
                        {
                          "type": "string",
                          "enum": [
                            "JSON"
                          ]
                        }
                      ],
                      "default": "HUMAN_READABLE"
                    },
                    "transformerConfigBase64": {
                      "type": "string",
                      "default": ""
                    }
                  }
                },
                "documentBackfillConfig": {
                  "type": "object",
                  "properties": {
                    "indexAllowlist": {
                      "type": "array",
                      "items": {
                        "type": "string"
                      },
                      "default": []
                    },
                    "podReplicas": {
                      "type": "number",
                      "default": 1
                    },
                    "loggingConfigurationOverrideConfigMap": {
                      "type": "string",
                      "default": ""
                    },
                    "allowLooseVersionMatching": {
                      "type": "boolean",
                      "default": true,
                      "description": ""
                    },
                    "docTransformerConfigBase64": {
                      "type": "string",
                      "default": ""
                    },
                    "documentsPerBulkRequest": {
                      "type": "number",
                      "default": 2147483647
                    },
                    "initialLeaseDuration": {
                      "type": "string",
                      "default": "PT10M"
                    },
                    "maxConnections": {
                      "type": "number",
                      "default": 10
                    },
                    "maxShardSizeBytes": {
                      "type": "number",
                      "default": 85899345920
                    },
                    "otelCollectorEndpoint": {
                      "type": "string",
                      "default": "http://otel-collector:4317"
                    },
                    "useTargetClusterForWorkCoordination": {
                      "type": "boolean",
                      "default": true
                    },
                    "resources": {
                      "type": "object",
                      "nullable": true,
                      "properties": {
                        "limits": {
                          "type": "object",
                          "properties": {
                            "cpu": {
                              "type": "string",
                              "pattern": "^[0-9]+m$",
                              "description": "CPU quantity in millicores (e.g., '100m', '500m')"
                            },
                            "memory": {
                              "type": "string",
                              "pattern": "^[0-9]+(([EPTGM])i?|Ki|k)$",
                              "description": "Memory quantity with unit (e.g., '512Mi', '2G')"
                            },
                            "ephemeral-storage": {
                              "type": "string",
                              "pattern": "^[0-9]+(([EPTGM])i?|Ki|k)$",
                              "description": "Storage quantity with unit (e.g., '10Gi', '5G')"
                            }
                          },
                          "required": [
                            "cpu",
                            "memory"
                          ],
                          "description": "Resource upper bound for a container"
                        },
                        "requests": {
                          "type": "object",
                          "properties": {
                            "cpu": {
                              "type": "string",
                              "pattern": "^[0-9]+m$",
                              "description": "CPU quantity in millicores (e.g., '100m', '500m')"
                            },
                            "memory": {
                              "type": "string",
                              "pattern": "^[0-9]+(([EPTGM])i?|Ki|k)$",
                              "description": "Memory quantity with unit (e.g., '512Mi', '2G')"
                            },
                            "ephemeral-storage": {
                              "type": "string",
                              "pattern": "^[0-9]+(([EPTGM])i?|Ki|k)$",
                              "description": "Storage quantity with unit (e.g., '10Gi', '5G')"
                            }
                          },
                          "required": [
                            "cpu",
                            "memory"
                          ],
                          "description": "Resource lower bound for a container"
                        }
                      },
                      "required": [
                        "limits",
                        "requests"
                      ],
                      "description": "Resource limits and requests for RFS container"
                    }
                  }
                }
              },
              "required": [
                "label"
              ]
            },
            "minItems": 1
          },
          "sourceVersion": {
            "type": "string"
          },
          "sourceLabel": {
            "type": "string"
          },
          "targetConfig": {
            "type": "object",
            "properties": {
              "endpoint": {
                "type": "string",
                "pattern": "^https?:\\/\\/[^:\\/\\s]+(:\\d+)?(\\/)?$"
              },
              "allowInsecure": {
                "type": "boolean",
                "default": false
              },
              "authConfig": {
                "anyOf": [
                  {
                    "type": "object",
                    "properties": {
                      "basic": {
                        "type": "object",
                        "properties": {
                          "secretName": {
                            "type": "string",
                            "pattern": "^[a-z0-9]([-a-z0-9]*[a-z0-9])?(\\.[a-z0-9]([-a-z0-9]*[a-z0-9])?)*$"
                          }
                        },
                        "required": [
                          "secretName"
                        ]
                      }
                    },
                    "required": [
                      "basic"
                    ]
                  },
                  {
                    "type": "object",
                    "properties": {
                      "sigv4": {
                        "type": "object",
                        "properties": {
                          "region": {
                            "type": "string"
                          },
                          "service": {
                            "type": "string",
                            "default": "es"
                          }
                        },
                        "required": [
                          "region"
                        ]
                      }
                    },
                    "required": [
                      "sigv4"
                    ]
                  },
                  {
                    "type": "object",
                    "properties": {
                      "mtls": {
                        "type": "object",
                        "properties": {
                          "caCert": {
                            "type": "string"
                          },
                          "clientSecretName": {
                            "type": "string"
                          }
                        },
                        "required": [
                          "caCert",
                          "clientSecretName"
                        ]
                      }
                    },
                    "required": [
                      "mtls"
                    ]
                  }
                ]
              },
              "label": {
                "type": "string",
                "pattern": "^[a-zA-Z0-9_]+$"
              }
            },
            "required": [
              "endpoint",
              "label"
            ]
          },
          "snapshotConfig": {
            "type": "object",
            "properties": {
              "label": {
                "type": "string"
              },
              "repoConfig": {
                "type": "object",
                "properties": {
                  "awsRegion": {
                    "type": "string",
                    "description": "The AWS region that the bucket reside in (us-east-2, etc)"
                  },
                  "endpoint": {
                    "type": "string",
                    "pattern": "(?:^(http|localstack)s?:\\/\\/[^/]*\\/?$)?",
                    "default": ""
                  },
                  "s3RepoPathUri": {
                    "type": "string",
                    "pattern": "^s3:\\/\\/[a-z0-9][a-z0-9.-]{1,61}[a-z0-9](\\/[a-zA-Z0-9!\\-_.*'()/]*)?$",
                    "description": "s3://BUCKETNAME/PATH"
                  },
                  "s3RoleArn": {
                    "type": "string",
                    "pattern": "^(arn:aws:iam::\\d{12}:(user|role|group|policy)\\/[a-zA-Z0-9+=,.@_-]+)?$",
                    "default": ""
                  },
                  "useLocalStack": {
                    "type": "boolean",
                    "default": false
                  },
                  "repoName": {
                    "type": "string"
                  }
                },
                "required": [
                  "awsRegion",
                  "s3RepoPathUri",
                  "repoName"
                ]
              }
            },
            "required": [
              "label",
              "repoConfig"
            ]
          }
        },
        "required": [
          "label",
          "snapshotNameResolution",
          "migrations",
          "sourceVersion",
          "sourceLabel",
          "targetConfig",
          "snapshotConfig"
        ]
      },
      "default": []
    },
    "trafficReplays": {
      "type": "array",
      "items": {
        "type": "object",
        "properties": {
          "fromProxy": {
            "type": "string"
          },
          "kafkaConfig": {
            "type": "object",
            "properties": {
              "enableMSKAuth": {
                "type": "boolean",
                "default": false
              },
              "kafkaConnection": {
                "type": "string",
                "pattern": "^(?:[a-z.]+:[0-9]+,?)*$"
              },
              "kafkaTopic": {
                "type": "string",
                "default": "",
                "description": "Empty defaults to the name of the target label"
              },
              "label": {
                "type": "string"
              }
            },
            "required": [
              "kafkaConnection",
              "label"
            ]
          },
          "toTarget": {
            "type": "object",
            "properties": {
              "endpoint": {
                "type": "string",
                "pattern": "^https?:\\/\\/[^:\\/\\s]+(:\\d+)?(\\/)?$"
              },
              "allowInsecure": {
                "type": "boolean",
                "default": false
              },
              "authConfig": {
                "anyOf": [
                  {
                    "type": "object",
                    "properties": {
                      "basic": {
                        "type": "object",
                        "properties": {
                          "secretName": {
                            "type": "string",
                            "pattern": "^[a-z0-9]([-a-z0-9]*[a-z0-9])?(\\.[a-z0-9]([-a-z0-9]*[a-z0-9])?)*$"
                          }
                        },
                        "required": [
                          "secretName"
                        ]
                      }
                    },
                    "required": [
                      "basic"
                    ]
                  },
                  {
                    "type": "object",
                    "properties": {
                      "sigv4": {
                        "type": "object",
                        "properties": {
                          "region": {
                            "type": "string"
                          },
                          "service": {
                            "type": "string",
                            "default": "es"
                          }
                        },
                        "required": [
                          "region"
                        ]
                      }
                    },
                    "required": [
                      "sigv4"
                    ]
                  },
                  {
                    "type": "object",
                    "properties": {
                      "mtls": {
                        "type": "object",
                        "properties": {
                          "caCert": {
                            "type": "string"
                          },
                          "clientSecretName": {
                            "type": "string"
                          }
                        },
                        "required": [
                          "caCert",
                          "clientSecretName"
                        ]
                      }
                    },
                    "required": [
                      "mtls"
                    ]
                  }
                ]
              },
              "label": {
                "type": "string",
                "pattern": "^[a-zA-Z0-9_]+$"
              }
            },
            "required": [
              "endpoint",
              "label"
            ]
          },
          "dependsOnSnapshotMigrations": {
            "type": "array",
            "items": {
              "type": "object",
              "properties": {
                "source": {
                  "type": "string"
                },
                "snapshot": {
                  "type": "string"
                }
              },
              "required": [
                "source",
                "snapshot"
              ]
            },
            "minItems": 1
          },
          "replayerConfig": {
            "type": "object",
            "properties": {
              "speedupFactor": {
                "type": "number",
                "default": 1.1
              },
              "podReplicas": {
                "type": "number",
                "default": 1
              },
              "authHeaderOverride": {
                "type": "string",
                "default": ""
              },
              "loggingConfigurationOverrideConfigMap": {
                "type": "string",
                "default": ""
              },
              "resources": {
                "type": "object",
                "properties": {
                  "limits": {
                    "type": "object",
                    "properties": {
                      "cpu": {
                        "type": "string",
                        "pattern": "^[0-9]+m$",
                        "description": "CPU quantity in millicores (e.g., '100m', '500m')"
                      },
                      "memory": {
                        "type": "string",
                        "pattern": "^[0-9]+(([EPTGM])i?|Ki|k)$",
                        "description": "Memory quantity with unit (e.g., '512Mi', '2G')"
                      },
                      "ephemeral-storage": {
                        "type": "string",
                        "pattern": "^[0-9]+(([EPTGM])i?|Ki|k)$",
                        "description": "Storage quantity with unit (e.g., '10Gi', '5G')"
                      }
                    },
                    "required": [
                      "cpu",
                      "memory"
                    ],
                    "description": "Resource upper bound for a container"
                  },
                  "requests": {
                    "type": "object",
                    "properties": {
                      "cpu": {
                        "type": "string",
                        "pattern": "^[0-9]+m$",
                        "description": "CPU quantity in millicores (e.g., '100m', '500m')"
                      },
                      "memory": {
                        "type": "string",
                        "pattern": "^[0-9]+(([EPTGM])i?|Ki|k)$",
                        "description": "Memory quantity with unit (e.g., '512Mi', '2G')"
                      },
                      "ephemeral-storage": {
                        "type": "string",
                        "pattern": "^[0-9]+(([EPTGM])i?|Ki|k)$",
                        "description": "Storage quantity with unit (e.g., '10Gi', '5G')"
                      }
                    },
                    "required": [
                      "cpu",
                      "memory"
                    ],
                    "description": "Resource lower bound for a container"
                  }
                },
                "default": {
                  "limits": {
                    "cpu": "2000m",
                    "memory": "4000Mi"
                  },
                  "requests": {
                    "cpu": "2000m",
                    "memory": "4000Mi"
                  }
                },
                "required": [
                  "limits",
                  "requests"
                ],
                "description": "Resource limits and requests for replayer container."
              }
            }
          }
        },
        "required": [
          "fromProxy",
          "kafkaConfig",
          "toTarget"
        ]
      },
      "default": []
    }
  }
}
