## Configuration Options

These tables list all CDK context configuration values a user can specify for this project. These will normally be added to the `cdk.context.json` file in the same directory as this markdown file.


### Migration Service Options

| Name                             | Type    | Example                                                                                | Description                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
|----------------------------------|---------|----------------------------------------------------------------------------------------|:-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| migrationAssistanceEnabled       | boolean | true                                                                                   | Flag which controls deploying common Migration Service resources such as MSK, EFS, and an ECS cluster. **Note**: This option must be enabled to use any Migration service                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
| addOnMigrationDeployId           | string  | "cit2-replay"                                                                          | Specify an ID string to use for an additional replay [scenario](./README.md#how-to-run-multiple-traffic-replayer-scenarios). **Note**: This option should not be used for initial deployments                                                                                                                                                                                                                                                                                                                                                                                                                                      |
| defaultFargateCpuArch            | string  | "X86_64", "ARM64"                                                                      | Provide a default CPU architecture that should be used for all containers. Defaults to using `process.arch` to determine the proper architecture to use                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| replayerOutputEFSRemovalPolicy   | string  | "DESTROY"                                                                              | Policy to apply when the Replayer output EFS filesystem is removed from the CloudFormation stack                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| artifactBucketRemovalPolicy      | string  | "RETAIN"                                                                               | Policy to apply when the artifact S3 bucket is removed from the CloudFormation stack                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
| migrationConsoleServiceEnabled   | boolean | true                                                                                   | Enable deploying the given service, via a new CloudFormation stack                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| trafficReplayerServiceEnabled    | boolean | true                                                                                   | Enable deploying the given service, via a new CloudFormation stack                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| captureProxyServiceEnabled       | boolean | true                                                                                   | Enable deploying the given service, via a new CloudFormation stack                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| captureProxyExtraArgs            | string  | `"--suppressCaptureForHeaderMatch user-agent .*elastic-java/7.17.0.*"`                 | Extra arguments to provide to the Capture Proxy command. This includes available arguments specified by the [Capture Proxy](../../../TrafficCapture/trafficCaptureProxyServer/src/main/java/org/opensearch/migrations/trafficcapture/proxyserver/CaptureProxy.java). [^1]                                                                                                                                                                                                                                                                                                                                                          |
| captureProxyJvmArgs              | string  | "-Xmx2g"                                                                               | JVM arguments to pass to the Capture Proxy via the `JDK_JAVA_OPTIONS` environment variable. These take precedence over the application's default `JAVA_TOOL_OPTIONS`. Use for heap tuning, GC flags, or system properties.                                                                                                                                                                                                                                                                                                                                                                                                        |
| kafkaBrokerServiceEnabled        | boolean | false                                                                                  | Enable deploying the given service, via a new CloudFormation stack. **This stack is experimental and should only be used for development**                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| otelCollectorEnabled             | boolean | true                                                                                   | Enable deploying an otel-collector within each service that uses it, in order to publish data to CloudWatch and X-Ray.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| trafficReplayerGroupId           | string  | "logging-group-default"                                                                | The Kafka consumer group ID the Replayer will use, if not specified a default ID will be used                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
| trafficReplayerUserAgentSuffix   | string  | "AWS/test/v1.0.0"                                                                      | A custom user agent that will be provided to the Replayer using the `--user-agent` flag. This will append the provided user agent to any existing user agents when requests are made to the target cluster. This setting could also be specified with the `trafficReplayerExtraArgs` option                                                                                                                                                                                                                                                                                                                                        |
| trafficReplayerExtraArgs         | string  | "--sigv4-auth-header-service-region es,us-east-1 --speedup-factor 5"                   | Extra arguments to provide to the Replayer command. This includes auth header options and other parameters supported by the [Traffic Replayer](../../../TrafficCapture/trafficReplayer/src/main/java/org/opensearch/migrations/replay/TrafficReplayer.java). [^1]                                                                                                                                                                                                                                                                                                                                                                  |
| trafficReplayerJvmArgs           | string  | "-Xmx4g -XX:+UseG1GC"                                                                 | JVM arguments to pass to the Traffic Replayer via the `JDK_JAVA_OPTIONS` environment variable. These take precedence over the application's default `JAVA_TOOL_OPTIONS`. Use for heap tuning, GC flags, or system properties.                                                                                                                                                                                                                                                                                                                                                                                                      |
| trafficReplayerMaxUptime         | string  | "P1D"                                                                                  | The maximum uptime for the Traffic Replayer service, specified in ISO 8601 duration format. This controls how long the Traffic Replayer will run before automatically shutting down. Example values: "PT1H" (hourly), "P1D" (daily). When this duration is reached, ECS will initiate the startup of a new Traffic Replayer task to ensure continuous operation. This mechanism ensures that the Traffic Replayer service can manage its resources effectively and prevent issues associated with long running processes. Set to the greater of the given value 5 minutes. When not specified, the replayer will run continuously. |
| albAcmCertArn                    | string  | `"arn:aws:acm:us-east-1:12345678912:certificate/abc123de-4888-4fa7-a508-3811e2d49fc3"` | The ACM certificate ARN to use for the ALB. If not specified, and an alb is required based on other deployment parameters, a custom resource will be deployed to create one. If creation must happen locally, a script has been provded to create and upload a cert and can be invoked with `npm run create-acm-cert` and will return the uploaded cert arn.                                                                                                                                                                                                                                                                       |
| targetClusterProxyServiceEnabled | boolean | false                                                                                  | Enable a non-capturing proxy to use a load balancer against a managed OpenSearch cluster. This is needed to enable alb cuttover to a managed opensearch cluster as there is no way to directly route an ALB listener to an AWS Managed OpenSearch Service. If this is specified an ALB will be deployed with listener.                                                                                                                                                                                                                                                                                                             |
| captureProxyDesiredCount         | integer | 0                                                                                      | Set scale for capture proxy service tasks                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
| targetClusterProxyDesiredCount   | integer | 0                                                                                      | Set scale for target proxy service tasks                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |

### Cluster Definition Options

| Name          | Type   | Example                                                                                                                    | Description                                                                                                        |
| ------------- | ------ | -------------------------------------------------------------------------------------------------------------------------- | :----------------------------------------------------------------------------------------------------------------- |
| sourceCluster | object | {"endpoint": "https://source-cluster.com", "auth": {"type": "basic", "username": "admin", "password": "admin"}}            | A json object defining the source cluster  endpoint, auth type, and other details. See below for detailed options. |
| targetCluster | object | {"endpoint": "https://target-cluster.com", "auth": {"type": "sigv4", "serviceSigningName": "aoss", "region": "us-east-1"}} | A json object defining the target cluster endpoint, auth type, and other details. See below for detailed options.  |

#### Structure of the cluster objects

If no source cluster is being configured, the source cluster object should be `{"disabled": true} and no other fields are necessary.

In all other cases, the required components of each cluster object are:

- `endpoint` -- the fully specified endpoint for the cluster
- `version` -- the Elasticsearch or OpenSearch version of the cluster, in the format of `OS_x.y` or `ES_x.y` This will be passed to the ReindexFromSnapshot service, if enabled, and provided for the metadata migration on the Migration Console.
- `auth` -- what authorization strategy the cluster has. The supported options are:
    1. No auth: `{"type": "none"}`
    2. Sigv4 Signing: `{"type": "sigv4", "region": "us-east-1", "serviceSigningName": "es"}` The serviceSigningName is `es` for Elasticsearch and OpenSearch managed service domains, and `aoss` for Amazon OpenSearch Serverless
    3. Basic auth with plaintext password (not recommended): `{"type": "basic", "username": "admin", "password": "admin123"}`
    4. Basic auth with secrets manager (recommended): `{"type": "basic", "userSecretArn": "arn:aws:secretsmanager:us-east-1:12345678912:secret:opensearch-secret-123abc"}`. This secret should include two key/value pairs, one for `username` and one for `password`

### Snapshot Definition Options

| Name     | Type   | Example                                                                                                                                                                    | Description                                                                                        |
|----------|--------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------|:---------------------------------------------------------------------------------------------------|
| snapshot | object | {"snapshotName": "test-snapshot", "snapshotRepoName": "test-snapshot-repo", "s3Uri": "s3://snapshot-bucket-123456789012-us-east-2/snapshot-repo", "s3Region": "us-east-2"} | A json object for defining the details of an existing S3 snapshot. See below for detailed options. |

#### Structure of the snapshot object

A snapshot should only be configured when the user has an existing snapshot they want to utilize for performing an RFS backfill or Metadata migration instead of creating a snapshot with the Migration Assistant.

In such case, the required fields in the snapshot object are:

- `snapshotName` -- the name of the existing snapshot that was created
- `snapshotRepoName` -- the name of the existing snapshot repository that contains the given `snapshotName`
- `s3Uri` -- the `s3://` URI path to where the snapshot repo exists in the given S3 bucket
- `s3Region` -- the region where the S3 bucket is located

### Reindex from Snapshot (RFS) Service Options

| Name                                | Type    | Example                                                              | Description                                                                                                                                                                                                                                                                          |
|-------------------------------------|---------|----------------------------------------------------------------------|:-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| reindexFromSnapshotServiceEnabled   | boolean | true                                                                 | Create resources for deploying and configuring the RFS ECS service                                                                                                                                                                                                                   |
| reindexFromSnapshotExtraArgs        | string  | "--target-aws-region us-east-1 --target-aws-service-signing-name es" | Extra arguments to provide to the Document Migration command with space separation. See [RFS Arguments](../../../DocumentsFromSnapshotMigration/README.md#Arguments). [^1]                                                                                                           |
| reindexFromSnapshotJvmArgs          | string  | "-Xmx8g"                                                            | JVM arguments to pass to the RFS worker via the `JDK_JAVA_OPTIONS` environment variable. These take precedence over the application's default `JAVA_TOOL_OPTIONS`. Use for heap tuning, GC flags, or system properties. |
| sourceClusterEndpoint               | string  | `"https://source-cluster.elb.us-east-1.endpoint.com"`                | The endpoint for the source cluster from which RFS will take a snapshot                                                                                                                                                                                                              |
| managedServiceSourceSnapshotEnabled | boolean | true                                                                 | Create the necessary roles and trust relationships to take a snapshot of a managed service source cluster. This is only compatible with SigV4 auth. Default as true if not specified and source cluster is set with sigv4 auth.                                                      |
| reindexFromSnapshotMaxShardSizeGiB  | integer | 80                                                                   | OPTIONAL: The size, in whole GiB, of the largest shard you want to migrate across all indices; used to ensure we have enough disk space reserved to perform the migration. Must be <= 80 if deploying in GovCloud region. Default: 80 GiB                                            |
| reindexFromSnapshotWorkerSize       | enum    | default or maximum                                                   | OPTIONAL: default provisions a 2vCPU worker balancing speed with cost efficiency designed for most migrations with horizontal scaling, maximum provisions a 16vCPU worker for high throughput migrations when parallelization is limited (low source shard count).  Default: default |

### VPC Options

| Name         | Type         | Example                                                  | Description                                                                                                     |
|--------------|--------------|----------------------------------------------------------|:----------------------------------------------------------------------------------------------------------------|
| vpcEnabled   | boolean      | true                                                     | Enable VPC to place Domain and Migration resources in. If a `vpcId` is not provided a new VPC will be created   |
| vpcId        | string       | "vpc-123456789abcdefgh"                                  | Specify an existing VPC to place the domain inside of                                                           |
| vpcSubnetIds | string array | ["subnet-123456789abcdefgh", "subnet-223456789abcdefgh"] | Specify the subnet IDs of an existing VPC to place the migration resources in. Requires `vpcId` to be specified |
| vpcAZCount   | number       | 2                                                        | The number of Availability Zones to utilize for a created or imported VPC                                       |

### MSK(Kafka) Options

| Name                             | Type         | Example                                                                                                 | Description                                                                                                                                                                                        |
| -------------------------------- | ------------ | ------------------------------------------------------------------------------------------------------- | :------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| mskBrokersPerAZCount             | number       | 1                                                                                                       | The number of broker nodes per MSK Availability Zone                                                                                                                                               |
| mskARN (Not currently available) | string       | `"arn:aws:kafka:us-east-2:12345678912:cluster/msk-cluster-test/81fbae45-5d25-44bb-aff0-108e71cc079b-7"` | Supply an existing MSK cluster ARN to use. **NOTE** As MSK is using an L1 construct this is not currently available for use                                                                        |

| MskEbsStorage                    | object       | `{ "maxCapacity": 16384 }`                                                                               | Configuration object for enabling MSK EBS storage autoscaling. `maxCapacity` sets the upper storage limit in GiB.                                                                                  | '

## Options being deprecated

A number of options are currently available but deprecated. While they function now, we do not recommend using them, and they may be removed without warning in a future version.

### OpenSearch Domain Options

| Name                            | Type         | Example                                                                                                                                                                                                                      | Description                                                                                                                                                                                                                                                         |
|---------------------------------|--------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|:--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| engineVersion                   | string       | "OS_1.3"                                                                                                                                                                                                                     | The Elasticsearch/OpenSearch version that your domain will leverage. In the format of `OS_x.y` or `ES_x.y`                                                                                                                                                          |
| domainName                      | string       | "os-service-domain"                                                                                                                                                                                                          | Name to use for the OpenSearch Service Domain                                                                                                                                                                                                                       |
| dataNodeType                    | string       | "r6g.large.search"                                                                                                                                                                                                           | The instance type for your data nodes. Supported values can be found [here](https://docs.aws.amazon.com/opensearch-service/latest/developerguide/supported-instance-types.html)                                                                                     |
| dataNodeCount                   | number       | 1                                                                                                                                                                                                                            | The number of data nodes to use in the OpenSearch Service Domain                                                                                                                                                                                                    |
| dedicatedManagerNodeType        | string       | "r6g.large.search"                                                                                                                                                                                                           | The instance type for your manager nodes. Supported values can be found [here](https://docs.aws.amazon.com/opensearch-service/latest/developerguide/supported-instance-types.html)                                                                                  |
| dedicatedManagerNodeCount       | number       | 3                                                                                                                                                                                                                            | The number of manager nodes to use in the OpenSearch Service Domain                                                                                                                                                                                                 |
| warmNodeType                    | string       | "ultrawarm1.medium.search"                                                                                                                                                                                                   | The instance type for your warm nodes. Supported values can be found [here](https://docs.aws.amazon.com/opensearch-service/latest/developerguide/limits.html#limits-ultrawarm)                                                                                      |
| warmNodeCount                   | number       | 3                                                                                                                                                                                                                            | The number of warm nodes to use in the OpenSearch Service Domain                                                                                                                                                                                                    |
| accessPolicies                  | JSON         | `{"Version":"2012-10-17","Statement":[{"Effect":"Allow","Principal":{"AWS":"arn:aws:iam::12345678912:user/test-user"},"Action":"es:ESHttp*","Resource":"arn:aws:es:us-east-1:12345678912:domain/cdk-os-service-domain/*"}]}` | Domain access policies                                                                                                                                                                                                                                              |
| useUnsignedBasicAuth            | boolean      | false                                                                                                                                                                                                                        | Configures the domain so that unsigned basic auth is enabled                                                                                                                                                                                                        |
| fineGrainedManagerUserARN       | string       | `"arn:aws:iam::12345678912:user/test-user"`                                                                                                                                                                                  | The IAM User ARN of the manager user. <br/>Fine grained access control also requires nodeToNodeEncryptionEnabled and encryptionAtRestEnabled to be enabled. <br/> Either fineGrainedManagerUserARN or fineGrainedManagerUserSecretARN can be enabled, but not both. |
| fineGrainedManagerUserSecretARN | string       | `"arn:aws:secretsmanager:us-east-1:12345678912:secret:opensearch-secret-123abc"`                                                                                                                                             | The AWS Secrets Manager key ARN that will be used to create the manager user. This secret should include two key/value pairs, one for `username` and one for `password`. Should not be used with fineGrainedManagerUserARN                                          |
| enableDemoAdmin                 | boolean      | false                                                                                                                                                                                                                        | Demo mode setting that creates a basic manager user with username: admin and password: myStrongPassword123! . **NOTE**: This should not be used in a production environment and is not compatible with previous fineGrained settings                                |
| enforceHTTPS                    | boolean      | true                                                                                                                                                                                                                         | Require that all traffic to the domain arrive over HTTPS                                                                                                                                                                                                            |
| tlsSecurityPolicy               | string       | "TLS_1_2"                                                                                                                                                                                                                    | The minimum TLS version required for traffic to the domain                                                                                                                                                                                                          |
| ebsEnabled                      | boolean      | true                                                                                                                                                                                                                         | Specify whether Amazon EBS volumes are attached to data nodes. Some instance types (i.e. r6gd) require that EBS be disabled                                                                                                                                         |
| ebsIops                         | number       | 4000                                                                                                                                                                                                                         | The number of I/O operations per second (IOPS) that the volume supports                                                                                                                                                                                             |
| ebsVolumeSize                   | number       | 15                                                                                                                                                                                                                           | The size (in GiB) of the EBS volume for each data node                                                                                                                                                                                                              |
| ebsVolumeType                   | string       | "GP3"                                                                                                                                                                                                                        | The EBS volume type to use with the Amazon OpenSearch Service domain. Supported values can be found [here](https://docs.aws.amazon.com/cdk/api/v2/docs/aws-cdk-lib.aws_ec2.EbsDeviceVolumeType.html)                                                                |
| encryptionAtRestEnabled         | boolean      | true                                                                                                                                                                                                                         | Enable Domain to encrypt data at rest                                                                                                                                                                                                                               |
| encryptionAtRestKmsKeyARN       | string       | `"arn:aws:kms:us-east-1:12345678912:key/abc123de-4888-4fa7-a508-3811e2d49fc3"`                                                                                                                                               | Supply the KMS key to use for encryption at rest. If encryptionAtRestEnabled is enabled and this value is not provided, the default KMS key for OpenSearch Service will be used                                                                                     |
| loggingAppLogEnabled            | boolean      | true                                                                                                                                                                                                                         | Specify if Amazon OpenSearch Service application logging should be set up                                                                                                                                                                                           |
| loggingAppLogGroupARN           | string       | `"arn:aws:logs:us-east-1:12345678912:log-group:test-log-group:*"`                                                                                                                                                            | Supply the CloudWatch log group to use for application logging. If not provided and application logs are enabled, a CloudWatch log group will be created                                                                                                            |
| nodeToNodeEncryptionEnabled     | boolean      | true                                                                                                                                                                                                                         | Specify if node to node encryption should be enabled                                                                                                                                                                                                                |
| vpcSecurityGroupIds             | string array | ["sg-123456789abcdefgh", "sg-223456789abcdefgh"]                                                                                                                                                                             | Specify the Security Groups that will be associated with the VPC endpoints for the Domain. Requires `vpcId` to be specified                                                                                                                                         |
| openAccessPolicyEnabled         | boolean      | false                                                                                                                                                                                                                        | Applies an open access policy to the Domain. **NOTE**: This setting should only be used for Domains placed within a VPC, and is applicable to many use cases where access controlled by Security Groups on the VPC is sufficient.                                   |
| domainRemovalPolicy             | string       | "RETAIN"                                                                                                                                                                                                                     | Policy to apply when the domain is removed from the CloudFormation stack                                                                                                                                                                                            |

### Imported Target Cluster Options

| Name                  | Type   | Example                                                                                           | Description                                                                                                                                                                    |
| --------------------- | ------ | ------------------------------------------------------------------------------------------------- | :----------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| targetClusterEndpoint | string | `"https://vpc-demo-opensearch-cluster-cv6hggdb66ybpk4kxssqt6zdhu.us-west-2.es.amazonaws.com:443"` | The target cluster endpoint which will be used to replay captured traffic against. This endpoint must be in the same VPC as the Migration services to allow for proper linking |

### Imported Source Cluster Options

| Name                  | Type    | Example                               | Description                                                                                                                                                                                                                                      |
| --------------------- | ------- | ------------------------------------- | :----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| sourceClusterDisabled | boolean | true                                  | Disable configuring a source cluster in any way. This is incompatible with specifying any type of capture proxy or a source cluster endpoint. It's suitable for backfill migrations using ReindexFromSnapshot from an already-existing snapshot. |
| sourceClusterEndpoint | string  | `"https://my-source-cluster.com:443"` | The URI of the source cluster from that the migration will reference. **Note**: if this is not provided and elasticsearchService is enabled, the migration will reference a uri for that service.                       |


### Other Options

| Name                        | Type    | Example | Description                                                        |
|-----------------------------|---------|---------|:-------------------------------------------------------------------|
| elasticsearchServiceEnabled | boolean | true    | Enable deploying the given service, via a new CloudFormation stack |
<!-- Footnotes -->

[^1]: Extra arguments can be added, overridden, or removed as follows:
    - To add/override an argument: Include the argument with the value, e.g., `"--new-arg value"`
    - Include quotes/escaping as appropriate for bash processing  `"--new-arg \"my value\""`

